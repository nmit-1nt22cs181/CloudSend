

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudSend - Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="background">
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="gradient-orb orb-3"></div>
        <div class="grid-overlay"></div>
    </div>

    <div class="container">
        <header class="main-header">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M13 10V3L4 14h7v7l9-11h-7z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="currentColor" opacity="0.8"/>
                        </svg>
                    </div>
                    <div class="logo-text">
                        <h1>CloudSend</h1>
                        <p class="subtitle">Decentralized Cloud Storage</p>
                    </div>
                </div>
                {% if current_user %}
                <div class="auth-controls">
                    <div class="user-badge">
                        <div class="user-avatar">
                            <span>{{ current_user.name[0] }}</span>
                        </div>
                        <div class="user-info">
                            <span class="user-name">{{ current_user.name }}</span>
                            <span class="user-status">‚óè Active</span>
                        </div>
                    </div>
                    <a href="/logout" class="btn btn-logout">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Logout
                    </a>
                </div>
                {% endif %}
            </div>
        </header>

        {% if current_user %}
        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-label">Total Files</span>
                    <span class="stat-value">{{ chain|length }}</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-label">Blockchain Verified</span>
                    <span class="stat-value">100%</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-label">Storage</span>
                    <span class="stat-value">Secure</span>
                </div>
            </div>
        </div>

        <!-- Action Cards -->
        <div class="action-section">
            <div class="action-card upload-card">
                <div class="card-header">
                    <div class="card-title">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <h2>Upload File</h2>
                    </div>
                    <span class="card-badge">IPFS Storage</span>
                </div>
                <form id="upload-form">
                    <div class="file-drop-zone" id="drop-zone">
                        <input type="file" name="file" id="file-input" required>
                        <div class="drop-zone-content">
                            <svg class="drop-icon" viewBox="0 0 24 24" fill="none">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5-5 5 5M12 5v12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <p class="drop-text">Drag & drop your file here</p>
                            <p class="drop-subtext">or</p>
                            <label for="file-input" class="file-input-label">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" stroke="currentColor" stroke-width="2"/>
                                </svg>
                                Choose File
                            </label>
                            <span id="file-name" class="file-name-display"></span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="upload-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        Upload to IPFS
                    </button>
                </form>
            </div>

            <div class="action-card view-card">
                <div class="card-header">
                    <div class="card-title">
                        <svg viewBox="0 0 24 24" fill="none">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        <h2>View File</h2>
                    </div>
                    <span class="card-badge">IPFS Network</span>
                </div>
                <div class="view-file-content">
                    <div class="input-group">
                        <svg class="input-icon" viewBox="0 0 24 24" fill="none">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <input type="text" id="ipfs-hash-input" placeholder="Enter IPFS Hash (e.g., Qm...)" class="input-text" required>
                    </div>
                    <button type="button" class="btn btn-secondary" id="view-file-btn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" stroke="currentColor" stroke-width="2"/>
                            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                        </svg>
                        View File
                    </button>
                    <p class="hint-text">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none">
                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                            <path d="M12 16v-4M12 8h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        File will open in a new tab for viewing and downloading
                    </p>
                </div>
            </div>
        </div>

        <!-- Files Table -->
        <div class="files-section">
            <div class="section-header">
                <div class="section-title">
                    <svg viewBox="0 0 24 24" fill="none">
                        <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <polyline points="13 2 13 9 20 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h2>Your Uploaded Files</h2>
                </div>
                <div class="file-count-badge">
                    <span>{{ chain|length }} file{{ 's' if chain|length != 1 else '' }}</span>
                </div>
            </div>
            
            <div class="table-container">
                {% if chain|length > 0 %}
                <div class="table-wrapper">
                    <table class="files-table">
                        <thead>
                            <tr>
                                <th class="col-index">#</th>
                                <th class="col-filename">
                                    <div class="th-content">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" stroke="currentColor" stroke-width="2"/>
                                            <polyline points="13 2 13 9 20 9" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        Filename
                                    </div>
                                </th>
                                <th class="col-hash">
                                    <div class="th-content">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        IPFS Hash
                                    </div>
                                </th>
                                <th class="col-time">
                                    <div class="th-content">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                                            <polyline points="12 6 12 12 16 14" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        Upload Time
                                    </div>
                                </th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="files-table-body">
                            {% for block in chain %}
                            <tr class="file-row">
                                <td class="col-index">
                                    <span class="index-badge">{{ loop.index }}</span>
                                </td>
                                <td class="col-filename">
                                    <div class="filename-cell">
                                        <svg class="file-icon" viewBox="0 0 24 24" fill="none">
                                            <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" stroke="currentColor" stroke-width="2"/>
                                            <polyline points="13 2 13 9 20 9" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        <span class="filename-text">{{ block.filename }}</span>
                                    </div>
                                </td>
                                <td class="col-hash">
                                    <div class="hash-cell">
                                        <code class="hash-code">{{ block.ipfs_hash }}</code>
                                    </div>
                                </td>
                                <td class="col-time">
                                    <span class="time-text">{{ block.uploaded_at | timestamp_to_string }}</span>
                                </td>
                                <td class="col-actions">
                                    <button class="btn-icon copy-btn" data-hash="{{ block.ipfs_hash }}" title="Copy Hash">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
                                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" stroke="currentColor" stroke-width="2"/>
                                        </svg>
                                        <span class="btn-text">Copy</span>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="empty-state">
                    <svg class="empty-icon" viewBox="0 0 24 24" fill="none">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h3>No Files Yet</h3>
                    <p>Upload your first file to get started with decentralized storage</p>
                </div>
                {% endif %}
            </div>
        </div>
        {% else %}
        <div class="error-container">
            <div class="error-icon">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </div>
            <h2>Authentication Required</h2>
            <p>You must be logged in to access the dashboard.</p>
            <a href="/login" class="btn btn-primary">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4M10 17l5-5-5-5M15 12H3" stroke="currentColor" stroke-width="2"/>
                </svg>
                Go to Login
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Upload Status Popup -->
    <div id="upload-popup" class="popup-overlay">
        <div class="popup-card">
            <button class="popup-close" id="close-x" aria-label="Close">
                <svg viewBox="0 0 24 24" fill="none">
                    <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </button>
            <div class="popup-icon" id="popup-icon"></div>
            <h3 id="popup-title" class="popup-title">Upload Status</h3>
            <p id="popup-message" class="popup-message"></p>
            <div id="popup-ipfs-hash" class="popup-hash"></div>
            <button class="btn btn-primary" id="close-popup-btn">Close</button>
        </div>
    </div>

    <!-- Session Expired Popup -->
    <div id="session-expired-popup" class="popup-overlay">
        <div class="popup-card">
            <div class="popup-icon error">
                <svg viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 8v4M12 16h.01" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </div>
            <h3 class="popup-title">Session Expired</h3>
            <p class="popup-message">Your session has expired. Please log in again.</p>
            <a href="/login" class="btn btn-primary">Login</a>
        </div>
    </div>

    <script src="/static/scripts.js"></script>
</body>
</html>